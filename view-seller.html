<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>View Seller ‚Äî SwapCart</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .seller-header {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .seller-products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container topbar">
      <div class="brand"><a href="index.html" style="text-decoration:none;color:#1500ff;">SwapCart</a></div>
      <div class="actions">
        <a href="index.html" class="icon-btn orange">Home</a>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="seller-header">
      <h2 id="seller-name"></h2>
      <p id="seller-email"></p>
      <button class="message-seller-btn" onclick="messageThisSeller()" style="margin-top:10px;">
        üí¨ Message This Seller
      </button>
    </div>

    <h3>üõçÔ∏è Seller's Products</h3>
    <div id="seller-products" class="seller-products"></div>
  </main>

  <!-- Global Chat Modal -->
  <div id="global-chat-modal" class="modal" style="display:none;">
    <div class="modal-content card" style="max-width:600px;margin:auto;">
      <h3 id="global-chat-with-name">Chat</h3>
      <div id="global-chat-messages" style="max-height:300px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin-bottom:10px;"></div>
      <textarea id="global-chat-input" rows="2" placeholder="Type your message..."></textarea>
      <button class="btn orange" id="global-send-chat-btn">Send</button>
      <button class="btn" id="global-close-chat-btn">Close</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    let currentSellerId = null;

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const sellerId = parseInt(params.get('id'));
      currentSellerId = sellerId;

      const users = JSON.parse(localStorage.getItem('users')) || [];
      const products = JSON.parse(localStorage.getItem('products')) || [];

      const seller = users.find(u => u.id === sellerId);
      const list = document.getElementById('seller-products');

      if (!seller) {
        document.getElementById('seller-name').textContent = 'Seller not found.';
        return;
      }

      document.getElementById('seller-name').textContent = seller.name;
      document.getElementById('seller-email').textContent = `üìß ${seller.email}`;

      const sellerProducts = products.filter(p => p.sellerId === sellerId);

      if (sellerProducts.length === 0) {
        list.innerHTML = '<div class="card">No products yet from this seller.</div>';
        return;
      }

      list.innerHTML = sellerProducts.map(p => `
        <div class="product-card" onclick="viewProduct(${p.id})">
          <div class="product-media">
            ${p.image ? `<img src="${p.image}" alt="${p.name}">` : `<div>${p.name}</div>`}
          </div>
          <div class="product-body">
            <div class="product-title">${p.name}</div>
            <div class="product-price">‚Ç±${Number(p.price).toFixed(2)}</div>
          </div>
        </div>
      `).join('');
    });

    function messageThisSeller() {
      if (currentSellerId) {
        startSellerChat(currentSellerId, 'General Inquiry');
      }
    }
  </script>
  
</body>
</html>